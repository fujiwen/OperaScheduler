# Opera数据库监控工具

这是一个用于监控Oracle Data Guard环境的工具，可以自动执行检查脚本、生成报告并通过邮件通知管理员。

## 功能特点

- 执行`check_standby.bat`和`daily_report.bat`批处理文件
- 分析执行结果和HTML报告，检测潜在问题
- 通过邮件发送监控报告和执行日志
- 支持定时自动监控
- 可配置的错误检测模式
- 友好的图形用户界面

## 安装依赖

本工具使用Python 3开发，需要安装以下依赖：

```bash
pip install tkinter
```

注意：在大多数Python安装中，tkinter已经包含在标准库中，可能不需要单独安装。

## 使用方法

### 1. 运行程序

```bash
python opera_monitor.py
```

### 2. 配置设置

首次运行时，程序会创建默认配置文件`opera_monitor.ini`。您可以通过界面中的"设置"菜单修改以下配置：

#### 路径设置

- **检查备用数据库脚本**：`check_standby.bat`的路径
- **每日报告脚本**：`daily_report.bat`的路径
- **HTML报告路径**：生成的HTML报告文件路径

#### 邮件设置

- **SMTP服务器**：邮件服务器地址
- **SMTP端口**：邮件服务器端口
- **发件人邮箱**：用于发送报告的邮箱地址
- **发件人密码**：邮箱密码或应用专用密码
- **收件人邮箱**：接收报告的邮箱地址（多个地址用逗号分隔）
- **使用TLS加密**：是否使用TLS加密连接
- **监控完成后自动发送邮件**：是否在监控完成后自动发送邮件

#### 监控设置

- **自动运行间隔**：自动监控的时间间隔（小时）
- **启用错误检查**：是否启用错误检查
- **错误模式**：用于检测问题的关键词（用逗号分隔）

### 3. 运行监控

- 点击"运行监控"按钮执行一次监控
- 点击"启动自动监控"按钮开始定时监控
- 点击"发送邮件报告"按钮手动发送监控报告
- 点击"查看HTML报告"按钮在浏览器中查看生成的HTML报告

## 文件说明

- `opera_monitor.py`：主程序文件
- `opera_monitor.ini`：配置文件
- `opera_monitor.log`：程序日志文件
- `logs/`：存放HTML报告和其他日志文件的目录

## 注意事项

1. 确保批处理文件路径正确，并且有权限执行
2. 如果使用邮件功能，请确保SMTP服务器设置正确
3. 对于某些邮件服务商，可能需要使用应用专用密码而不是账户密码
4. 程序会自动创建`logs`目录用于存放报告文件

## 故障排除

- 如果批处理文件无法执行，请检查路径设置和文件权限
- 如果邮件发送失败，请检查SMTP设置和网络连接
- 查看`opera_monitor.log`文件获取详细的错误信息